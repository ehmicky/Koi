
                        
   HTTP-CACHE-SEMANTICS  
                        



VERSION ==>                       #4.0.3

new HttpCacheSemantics            #HTTP caching logic for servers to know whether to cache responses and whether to serve them.
 (REQ], RES[, OPTS])              #OPTS:
                                  #  - shared BOOL (def: true): if server cache is shared by other clients
                                  #  - trustServerDate BOOL (def: true): if server can be trusted
                                  #  - cacheHeuristic NUM (def: 0.1): fallback TTL to percentage of response's age
                                  #  - immutableMinTimeToLive NUM (def: 1 day, in ms): minimum TTL if Cache-Control: immutable [C]

SEMANTICS                         #Cache information for a specific resource (method + URL)

SEMANTICS.toObject(SEMANTICS)->OBJ#Serialize to JSON-serializable OBJ
fromObject(OBJ)->SEMANTICS        #Parse from such OBJ

SEMANTICS.storable()->BOOL        #Whether resource|SEMANTICS can be cached for later requests.
                                  #false if either:
                                  #  - Cache-Control: no-store [C|S]
                                  #  - Cache-Control: private [S] and OPTS.shared true
                                  #  - not GET|HEAD|POST
                                  #  - POST and:
                                  #     - no Expires [S]
                                  #     - no Cache-Control: maxage [S]
                                  #     - no Cache-Control: s-maxage [S] or OPTS.shared false
                                  #  - not 200|203|204|300|301|302|303|307|308|404|405|410|414|501
                                  #  - 302|303|307|308 and no Expires [S] nor Cache-Control: public|[s-]maxage [C]
                                  #  - Authorization [C] and OPTS.shared true and no Cache-Control: must-revalidate|public|s-maxage [C]
SEMANTICS.date()->'TIMESTAMP'     #Resource's timestamp using Date [S]
                                  #Returns current time instead if either:
                                  #  - OPTS.trustServerDate false
                                  #  - more than 8 hours away from current time
SEMANTICS.age()->NUM              #Resource's age using max of Age [S] or age using Date [S], in secs
SEMANTICS.maxAge()->NUM           #Resource's max age.
                                  #0 if either:
                                  #  - storable() false
                                  #  - Cache-Control: no-cache [C]
                                  #  - OPTS.shared true and either:
                                  #     - Cache-Control: proxy-revalidate [C]
                                  #     - Set-Cookie [S] and no Cache-Control: public|immutable [C]
                                  #  - Vary: * [S]
                                  #Otherwise returns (in secs):
                                  #  - Cache-Control: s-maxage [C] (if OPTS.shared true)
                                  #  - Cache-Control: maxage [C]
                                  #  - Expires [S]
                                  #  - OPTS.cacheHeuristic * age using Last-Modified [S]
                                  #The last two return at least OPTS.immutableMinTimeToLive if Cache-Control: immutable [C]
SEMANTICS.timeToLive()->NUM       #Max of age() or maxAge() (in ms)
SEMANTICS.stale()->BOOL           #Whether age() > maxAge()

SEMANTICS.                        #Whether REQ can use previously cached resource|SEMANTICS.
 satisfiesWithoutRevalidation     #Return false if either:
 (REQ)->BOOL                      #  - different method, URL, Host [C] and (if Vary [S]) headers
                                  #  - age() > Cache-Control: max-age [C]
                                  #  - age() > maxAge() unless:
                                  #     - Cache-Control: max-stale [C] matches
                                  #     - no Cache-Control: must-revalidate [C]
                                  #  - timeToLive() < Cache-Control: min-fresh [C]
                                  #  - Cache-Control|Pragma: no-cache [C]
SEMANTICS.responseHeaders()->OBJ  #Response headers to set on a RES that use a cached resource.
                                  #Return same response headers as cached resource but:
                                  #  - without Date|Connection|Keep-Alive|Proxy-Authenticate|Proxy-Authorization|TE|Trailer|Transfer-Encoding|Upgrade [S]
                                  #  - with Date [S] using current time
                                  #  - with Age [S] using age()

SEMANTICS.revalidatedPolicy       #When !satisfiesWithoutRevalidation() and server is a proxy, we need to make a REQ to origin server (which responds with RES).
 (REQ, RES)->OBJ                  #Returns new resource|SEMANTICS to cache.
                                  #OBJ:
                                  #  - policy SEMANTICS
                                  #  - matches BOOL:
                                  #     - true if 304 and same ETag|Last-Modified [S]
                                  #     - if true, SEMANTICS is cloned
                                  #  - modified BOOL:
                                  #     - false if 304, i.e. can re-use previously cached RES
SEMANTICS.revalidationHeaders(REQ)#Request headers to set on a REQ when making such request to origin server.
 ->OBJ                            #Return same request headers as cached resource but:
                                  #  - without Date|Connection|Keep-Alive|Proxy-Authenticate|Proxy-Authorization|TE|Trailer|Transfer-Encoding|Upgrade [C]
                                  #  - without If-Range [C]
                                  #  - if ETag [S], If-None-Match: ETAG [S]
                                  #  - if Last-Modified [S], If-Modified-Since: DATE [S]
                                  #  - both If-Non-Match|If-Modified-Since [S] are removed if not storable() or different method, URL, Host [C] or (if Vary [S]) headers:




new CacheableRequest(REQ, ADAPTER)
